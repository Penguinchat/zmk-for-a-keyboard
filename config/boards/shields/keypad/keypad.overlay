#include "keypad.dtsi"
#include <zephyr/dt-bindings/led/led.h>

// 1. 定义物理LED灯带节点（如WS2812），标签必须为led_strip
led_strip: ws2812@0 {
    compatible = "worldsemi,ws2812-spi"; // 与led_strip_remap.c中的DT_DRV_COMPAT匹配
    spi-max-frequency = <8000000>;       // SPI通信频率
    chain-length = <22>;                 // 与keypad.json中的按键数一致（22个LED）
    // 根据实际硬件修改SPI总线和引脚（示例：使用SPI0，CS引脚为P0.15）
    spi = <&spi0 0 CS_GPIOS_PIN(0, 15) GPIO_ACTIVE_LOW>;
};

// 2. 定义LED重映射节点，标签为led_remap（与zmk_behavior_layer_led.c中的引用匹配）
led_remap: led_strip_remap@0 {
    compatible = "zmk,led-strip-remap";  // 与绑定文件zmk,led-strip-remap.yaml匹配
    chain-length = <22>;                 // 与物理灯带长度一致
    led_strip = <&led_strip>;            // 引用上面定义的物理灯带节点（必须为led_strip）
    map = <0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21>; // LED顺序映射

    // 层指示器子节点（与代码中的"LAYER_INDICATOR"标签对应）
    layer_indicator: layer_indicator {
        label = "LAYER_INDICATOR";       // 与zmk_behavior_layer_led.c中的标签匹配
        led-indexes = <0 1>;             // 用于层指示的LED索引（示例：第0和1个LED）
        colors = <0xff0000 0x00ff00 0x0000ff 0xffff00>; // 层0-3的颜色（RGB格式）
    };
};
